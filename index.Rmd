---
title: "Analysis of Data on the Existing Coastal and Marine Protected Areas"
site: bookdown::bookdown_site
output: bookdown::gitbook #bookdown::html_document2
documentclass: book
github-repo: jbaafi/BIOL4650-marine_conservation
description: "Guide to help in analyzing data of coastal and marine protected areas"
---

# Getting started and Learning R {-}

If you have not used `R` previously, we recommend that you work through Chapters 1 to 10 of the [Quantitative training guide](https://ahurford.github.io/quant-guide-all-courses/), which includes instructions on how to install `R` on a computer.

# How to do the analysis in R {-}

## Data importation and filtering {-}

Let's explore the _protected areas_ data from the World Database on Protected Areas.

1.  It is best to make a folder on your computer Desktop where you will work on this assignment (if needed, review [Best Practices](https://ahurford.github.io/quant-guide-all-courses/style.html)).

2.  Download the `.csv` file spreadsheet for protected areas in the country you are studying from the _World Database on Protected Areas_ to the folder you made. You may rename the `.csv` file you downloaded eg. `protected_areas.csv`

3.  [Open and save a new R Script](https://ahurford.github.io/quant-guide-all-courses/rstudio.html#source-pane%5D) in your folder. One of the first commands of your R Script will be to [load your data](https://ahurford.github.io/quant-guide-all-courses/data-entry.html#loading-or-importing-data). For example:

```{r}
data1 <- read.csv(file = "protected_areas.csv")
```

4.  In the [Console](https://ahurford.github.io/quant-guide-all-courses/rstudio.html#console-pane), inspect your data to check that it has loaded. For example:

```{r, results=FALSE}
head(data1)
```

If your data has not loaded, the most likely problem is a spelling error or problems with specifying the [path](https://ahurford.github.io/quant-guide-all-courses/rintro.html#working-directory) to `protected_areas.csv`. You might try:

-   the [RStudio way](https://ahurford.github.io/quant-guide-all-courses/data-entry.html#the-rstudio-way-the-import-feature) of importing your data, or

-   moving `protected_areas.csv` to your [working directory](https://ahurford.github.io/quant-guide-all-courses/data-entry.html#the-rstudio-way-the-import-feature).

5.  After importing the data into R, read through the metadata file that is downloaded as a pdf file along with the `.csv` file to better understand the data.

> **Data and metadata can be found here**

> <https://www.protectedplanet.net/en/search-areas?geo_type=site>

```{r}
head(data1)
```

6.  You will want to do some exploration of your data. See [Handling the data](https://ahurford.github.io/quant-guide-all-courses/handling-data.html) for how to recover the names of the columns for all the data.

```{r}
names(data1)
```
7. You could also use the `summary()` function to run a quick statistical summary of the data frame, calculating mean, median and quartile values for continuous variables. Try this in the `Console`

```{r}
summary(data1)
```

8. To extract a column of the data, see [Handling the data](https://ahurford.github.io/quant-guide-all-courses/handling-data.html). You may use either Approach 1: base R or Approach 2: `dplyr` (generally, the `dplyr` commands tend to be simpler, however, it is good to also know the base R commands).

**Approach 1: Base R**

To view the `MARINE`, column of the data in the `Console`, try:

```{r, results=FALSE}
data1$MARINE
```

Be sure to type exactly `MARINE` after the `$`.


You need to write the column name exactly as it appear in the output of `names(data1)` or RStudio will produce an error. Remember `MARINE` is captalized in the data frame so be careful not to type `Marine` which will come out as an error. 

**Approach 2: dplyr**

To use the [`dplyr` functions](https://ahurford.github.io/quant-guide-all-courses/handling-data.html#dplyr) you need to load the package (and [install](https://ahurford.github.io/quant-guide-all-courses/rintro.html#r-packages) if you have not already done so):

```{r,message=F}
library(dplyr)
```

For the `MARINE`, in the `Console`, try:

```{r, results = F}
select(data1, MARINE)
```

Note that the output of `select(data1, MARINE)` is a data frame.

9.  We want to separate protected areas identified as exclusively terrestrial from those that include marine areas. Try this in the `Console`:

```{r, results=F}
filter(data1, MARINE == 0)
```
## Creating a new object {-}
This section is focused on subsetting the dataset which was named as `data1` and creating a new object to hold the processed data. We call this `data2`.

1. We want to filter the data to include marine areas and exclude terrestrial areas and hold it as `data2`. Let's run this code in the `Console`:

```{r, results=F}
data2 <- filter(data1, MARINE != 0)
```

2. We want to compute the average size of coastal MPAs. Before we do this, we will need to filter the data to remove rows with null values in the `REP_AREA` column. Try this code in the `Console`

```{r, results=F}
data2 <- filter(data2, !is.na(REP_AREA))
```

3. Now we can calculate the average size of the coastal MPAs. Let's run this code:

```{r, results=F}
mean(data2$REP_AREA)
```

4. The median size of the coastal MPAs can also be found by running a similar code as follows:
```{r, results=F}
median(data2$REP_AREA)
```

## Graphing the data{-}

This section will give a brief overview of how to use graphs to understand some key concepts from the data which would be difficult to understand by just studying the raw data.

1. First, we would like to graph the the number of areas in each level of protection. To do this, we will have to group the data according to the level of protection and count the number of areas in each level of protection and saving it as `data3`. Let's do it by running this code in the `Console` 

```{r, results=F}
data3 <- data1 %>% group_by(IUCN_CAT) %>% tally()
```

Now we delete the rows that has `NAs` by running this

```{r, results=F}
data3 <- data3[-c(6, 7, 8), ] 
```
Now we can use a barplot to show the number of areas under each level of protection. The following code is able to do this

```{r, results=F}
barplot(data3$n,  xlab = "Level of protection", ylab="Number of areas", names.arg=c("Ia","Ib","II","III","IV","V","VI"), las=1, main="Number of areas for each level of protection")
```

2. Now we would like to calculate the amount of area that is strongly protected. We can do this by grouping by the `IUCN_CAT` column of the dataset and summing the `REP_AREA` accordingly and naming the resulting data as `data4`. Let's run this code in the `Console`
```{r, results=F}
data4 <- data1 %>% group_by(IUCN_CAT) %>% summarise(REP_AREA = sum(REP_AREA))
```

The barplot showing the area allocations could be plotted by running this code in the `Console`

```{r, results=F}
barplot(data4$REP_AREA, xlab = "Level of protection", ylab="Area(Amt. land and water/km^2)", names.arg=c("Ia","Ib","II","III","IV", "NA", "NA","NR" ,"V", "VI"), las=3, main="Area of land and water for each level of protection")
``` 

3. We would like to construct a histogram to graph the size-frequency distribution. The nature of the data, would require that we use a log-scale histogram to be able to view the frequency of each bin we create for the size.  The following `code` divide the sizes into bins and create a barplot that shows the frequency for each size range. s

```{r}
bins <- c(0, 250000, 500000, 750000, 1000000, 1250000, 1500000, 1750000, 2000000)
marine_hist <- hist(data2$REP_AREA, breaks=bins, plot=FALSE)
barplt <- barplot(marine_hist$count, log="y", 
              names.arg=c(250000, 500000, 750000, 1000000, 1250000, 1500000, 1750000, 2000000),
              xlab = "Size of MPAs",
              ylab = "log of the frequency (log(y))",
              main = "Graph showing the size-frequency distribution of MPAs",
              las=1)
text(barplt, marine_hist$counts, labels=marine_hist$counts, pos=1)
```

4. Using the `group_by` function, 



